# 5. 智能代码编辑与重构

## 5.1 智能代码补全

### 5.1.1 基本补全
- 输入时自动显示代码建议
- 使用 `Tab` 或 `Enter` 接受补全
- 使用 `Ctrl+Space` 手动触发补全

### 5.1.2 上下文感知补全
- 基于项目类型和上下文的智能建议
- 自动导入所需的包和模块
- 根据变量类型提供方法和属性建议

## 5.2 代码生成

### 5.2.1 代码片段
- 使用预定义的代码片段快速生成常用结构
- 支持自定义代码片段
- 使用 `Tab` 在片段占位符间跳转

### 5.2.2 AI 辅助生成
- 使用自然语言描述功能需求
- 生成函数、类或模块的骨架代码
- 根据注释自动生成文档字符串

## 5.3 重构工具

### 5.3.1 重命名
- 安全地重命名变量、函数、类等
- 自动更新所有引用
- 预览更改内容

### 5.3.2 提取方法/变量
- 将选中的代码提取为独立方法
- 提取重复表达式为变量
- 自动处理作用域和依赖

### 5.3.3 内联
- 将变量或方法内联到调用处
- 自动处理类型转换和返回值

## 5.4 代码优化建议

### 5.4.1 代码异味检测
- 识别重复代码
- 检测过长函数和复杂表达式
- 发现未使用的变量和导入

### 5.4.2 性能提示
- 识别潜在的性能问题
- 建议更高效的算法或数据结构
- 内存使用优化建议

## 5.5 批量编辑

### 5.5.1 多光标编辑
- 使用 `Alt+Click` 添加多个光标
- 使用 `Ctrl+Alt+↑/↓` 添加上下行的光标
- 使用 `Ctrl+D` 选择下一个匹配项

### 5.5.2 查找和替换
- 支持正则表达式查找替换
- 在选定范围内替换
- 保存常用的替换模式

## 5.6 代码格式化

### 5.6.1 自动格式化
- 保存时自动格式化代码
- 使用项目特定的格式化规则
- 支持多种代码风格指南

### 5.6.2 自定义格式化
- 配置缩进、引号等格式选项
- 为不同语言设置特定规则
- 导入/导出格式配置

## 5.7 重构实战示例

### 5.7.1 示例一：提取方法
```python
# 重构前
def process_data(data):
    # 处理数据
    result = []
    for item in data:
        if item > 0:
            result.append(item * 2)
    return result

# 重构后
def filter_and_double(positive_items):
    return [item * 2 for item in positive_items]

def process_data(data):
    return filter_and_double([item for item in data if item > 0])
```

### 5.7.2 示例二：使用更现代的语法
```python
# 重构前
with open('data.txt', 'r') as f:
    lines = f.readlines()
    for line in lines:
        if 'error' in line:
            print(line.strip())

# 重构后
from pathlib import Path

error_lines = (line.strip() for line in Path('data.txt').read_text().splitlines()
              if 'error' in line)
print('\n'.join(error_lines))
```

## 5.8 重构最佳实践

1. **小步前进**：每次重构只做一个小改动
2. **频繁测试**：确保每次重构后代码仍能正常工作
3. **使用版本控制**：保存重构前的代码状态
4. **先理解再重构**：确保理解代码的作用后再进行修改

---

> 下一章：[自动化开发流程](./6-自动化开发流程.md)

## 练习

1. **基础重构**：练习使用重命名功能安全地修改变量和函数名
2. **代码补全**：体验AI代码补全功能，观察建议的准确性
3. **提取方法**：将一个复杂函数分解为多个小函数
4. **格式化练习**：设置代码格式化规则并应用到项目中
5. **多光标编辑**：练习使用多光标进行批量编辑操作
